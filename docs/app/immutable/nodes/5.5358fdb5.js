import{s as J,n as H,o as K,j as N}from"../chunks/scheduler.802f7c56.js";import{S as L,i as O,g as z,s as E,m as j,h as I,y as Q,c as A,j as V,n as P,f as g,l as x,k as M,a as k,x as C,z as G,o as D,A as R}from"../chunks/index.d2a17b03.js";import{e as U}from"../chunks/each.e59479a4.js";function B(s,t,a){const l=s.slice();return l[14]=t[a],l}function W(s){let t=s[14].name+"",a;return{c(){a=j(t)},l(l){a=P(l,t)},m(l,r){k(l,a,r)},p(l,r){r&2&&t!==(t=l[14].name+"")&&D(a,t)},d(l){l&&g(a)}}}function X(s){let t=s[14].preferred_common_name+"",a;return{c(){a=j(t)},l(l){a=P(l,t)},m(l,r){k(l,a,r)},p(l,r){r&2&&t!==(t=l[14].preferred_common_name+"")&&D(a,t)},d(l){l&&g(a)}}}function F(s){let t,a,l,r,h;function m(c,u){return c[14].preferred_common_name?X:W}let _=m(s),i=_(s);function y(){return s[9](s[14])}return{c(){t=z("div"),i.c(),a=E(),this.h()},l(c){t=I(c,"DIV",{class:!0});var u=V(t);i.l(u),a=A(u),u.forEach(g),this.h()},h(){M(t,"class",l=N(s[14].seen?"taxon seen":"taxon unseen")+" svelte-lyf5s2")},m(c,u){k(c,t,u),i.m(t,null),C(t,a),r||(h=G(t,"click",y),r=!0)},p(c,u){s=c,_===(_=m(s))&&i?i.p(s,u):(i.d(1),i=_(s),i&&(i.c(),i.m(t,a))),u&2&&l!==(l=N(s[14].seen?"taxon seen":"taxon unseen")+" svelte-lyf5s2")&&M(t,"class",l)},d(c){c&&g(t),i.d(),r=!1,h()}}}function Y(s){let t,a="^",l,r,h=(s[0].preferred_common_name?s[0].preferred_common_name:s[0].name)+"",m,_,i,y,c,u,p,b,T,v=U(s[1]),f=[];for(let e=0;e<v.length;e+=1)f[e]=F(B(s,v,e));return{c(){t=z("span"),t.textContent=a,l=E(),r=z("h1"),m=j(h),_=E(),i=j(s[3]),y=j("%"),u=E(),p=z("div");for(let e=0;e<f.length;e+=1)f[e].c();this.h()},l(e){t=I(e,"SPAN",{style:!0,"data-svelte-h":!0}),Q(t)!=="svelte-xzap04"&&(t.textContent=a),l=A(e),r=I(e,"H1",{style:!0});var n=V(r);m=P(n,h),_=A(n),i=P(n,s[3]),y=P(n,"%"),n.forEach(g),u=A(e),p=I(e,"DIV",{class:!0,style:!0});var o=V(p);for(let d=0;d<f.length;d+=1)f[d].l(o);o.forEach(g),this.h()},h(){x(t,"margin-right","1em"),x(t,"font-family","sans-serif"),x(t,"font-size","12px"),x(t,"user-select","none"),x(t,"height","6px"),M(r,"style",c=`margin-top: 0; user-select: none; width: max-content; ${s[2][s[0].id]?"color: #050; background-color: #dfd":"color: #444;"}`),M(p,"class","taxa svelte-lyf5s2"),x(p,"user-select","none")},m(e,n){k(e,t,n),k(e,l,n),k(e,r,n),C(r,m),C(r,_),C(r,i),C(r,y),k(e,u,n),k(e,p,n);for(let o=0;o<f.length;o+=1)f[o]&&f[o].m(p,null);b||(T=G(t,"click",s[5]),b=!0)},p(e,[n]){if(n&1&&h!==(h=(e[0].preferred_common_name?e[0].preferred_common_name:e[0].name)+"")&&D(m,h),n&8&&D(i,e[3]),n&5&&c!==(c=`margin-top: 0; user-select: none; width: max-content; ${e[2][e[0].id]?"color: #050; background-color: #dfd":"color: #444;"}`)&&M(r,"style",c),n&18){v=U(e[1]);let o;for(o=0;o<v.length;o+=1){const d=B(e,v,o);f[o]?f[o].p(d,n):(f[o]=F(d),f[o].c(),f[o].m(p,null))}for(;o<f.length;o+=1)f[o].d(1);f.length=v.length}},i:H,o:H,d(e){e&&(g(t),g(l),g(r),g(u),g(p)),R(f,e),b=!1,T()}}}const S="https://api.inaturalist.org/v1/";function Z(s,t,a){let l,r,h,m={id:48460,name:"elämä"},_=[],i=[],y={},c={};const u=e=>e>=.1?Math.round(e*100):e>=.01?Math.round(e*1e3)/10:Math.round(e*1e4)/100,p=async e=>{let n=1;const o=200;let d=[];for(;;){const q=await(await fetch(S+`taxa?parent_id=${e}&locale=fi&order=desc&order_by=observations_count&per_page=200&page=${n}`)).json();if(d=d.concat(q.results),n*o>q.total_results)break;n+=1}return d},b=async()=>{const e=await p(m.id);a(1,_=e);for(let n of _)i.includes(n.id)?n.seen=!0:n.seen=!1;a(1,_=_.sort((n,o)=>o.seen&&n.seen?c[o.id]-c[n.id]:o.seen-n.seen))},T=async e=>{a(0,m=e),await b()},v=async()=>{const e=m.ancestry.split("/"),n=e[e.length-1],d=await(await fetch(S+`taxa?id=${n}&locale=fi`)).json();a(0,m=d.results[0]),await b()};K(async()=>{const n=await(await fetch(S+"taxa/lifelist_metadata?observed_by_user_id=ilrr&locale=fi")).json();a(6,i=n.results.map(w=>w.id));const d=await(await fetch(S+"observations/taxonomy?user_id=ilrr")).json();console.log(d.results);for(let w of d.results)a(2,y[w.id]=w.direct_obs_count,y),c[w.id]=w.descendant_obs_count;a(2,y),c=c,b()});const f=e=>T(e);return s.$$.update=()=>{s.$$.dirty&2&&a(8,l=_.filter(e=>e.seen).length),s.$$.dirty&65&&a(7,r=i.includes(m.id)),s.$$.dirty&386&&a(3,h=_.length?u(l/_.length):r?100:0)},[m,_,y,h,T,v,i,r,l,f]}class se extends L{constructor(t){super(),O(this,t,Z,Y,J,{})}}export{se as component};
